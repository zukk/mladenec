<form action="{Route::url('user_city')}" method="post" id="user_city" class="ajax">

    <label for="city-in-popup" style="float:left; margin-right:20px; line-height:28px; font-weight: bold;">Выберите город из&nbsp;списка или укажите вручную:</label>
    <input type="text" class="txt fl" placeholder="Ваш город" name="city" id="city-in-popup"/>
    <input type="submit" class="butt small fl ml20" value="Да!" name="save_city">

    <p class="cb">
        <a class="abbr">Абакан</a>
        <a class="abbr">Альметьевск</a>
        <a class="abbr">Ангарск</a>
        <a class="abbr">Арзамас</a>
        <a class="abbr">Армавир</a>
        <a class="abbr">Артём</a>
        <a class="abbr">Архангельск</a>
        <a class="abbr">Астрахань</a>
        <a class="abbr">Ачинск</a>
        <a class="abbr">Балаково</a>
        <a class="abbr">Балашиха</a>
        <a class="abbr">Барнаул</a>
        <a class="abbr">Батайск</a>
        <a class="abbr">Белгород</a>
        <a class="abbr">Бердск</a>
        <a class="abbr">Березники</a>
        <a class="abbr">Бийск</a>
        <a class="abbr">Благовещенск</a>
        <a class="abbr">Братск</a>
        <a class="abbr">Брянск</a>
        <a class="abbr">Великий Новгород</a>
        <a class="abbr">Владивосток</a>
        <a class="abbr">Владикавказ</a>
        <a class="abbr">Владимир</a>
        <a class="abbr">Волгоград</a>
        <a class="abbr">Волгодонск</a>
        <a class="abbr">Волжский</a>
        <a class="abbr">Вологда</a>
        <a class="abbr">Воронеж</a>
        <a class="abbr">Грозный</a>
        <a class="abbr">Дербент</a>
        <a class="abbr">Дзержинск</a>
        <a class="abbr">Димитровград</a>
        <a class="abbr">Домодедово</a>
        <a class="abbr">Евпатория</a>
        <a class="abbr">Екатеринбург</a>
        <a class="abbr">Елец</a>
        <a class="abbr">Ессентуки</a>
        <a class="abbr">Железнодорожный</a>
        <a class="abbr">Жуковский</a>
        <a class="abbr">Златоуст</a>
        <a class="abbr">Иваново</a>
        <a class="abbr">Ижевск</a>
        <a class="abbr">Иркутск</a>
        <a class="abbr">Йошкар-Ола</a>
        <a class="abbr">Казань</a>
        <a class="abbr">Калуга</a>
        <a class="abbr">Каменск</a>
        <a class="abbr">Камышин</a>
        <a class="abbr">Каспийск</a>
        <a class="abbr">Кемерово</a>
        <a class="abbr">Керчь</a>
        <a class="abbr">Киров</a>
        <a class="abbr">Кисловодск</a>
        <a class="abbr">Ковров</a>
        <a class="abbr">Коломна</a>
        <a class="abbr">Комсомольск-на-Амуре</a>
        <a class="abbr">Копейск</a>
        <a class="abbr">Королёв</a>
        <a class="abbr">Кострома</a>
        <a class="abbr">Красногорск</a>
        <a class="abbr">Краснодар</a>
        <a class="abbr">Красноярск</a>
        <a class="abbr">Курган</a>
        <a class="abbr">Курск</a>
        <a class="abbr">Кызыл</a>
        <a class="abbr">Липецк</a>
        <a class="abbr">Люберцы</a>
        <a class="abbr">Магнитогорск</a>
        <a class="abbr">Майкоп</a>
        <a class="abbr">Махачкала</a>
        <a class="abbr">Миасс</a>
        <a class="abbr">Москва</a>
        <a class="abbr">Мурманск</a>
        <a class="abbr">Муром</a>
        <a class="abbr">Мытищи</a>
        <a class="abbr">Набережные Челны</a>
        <a class="abbr">Назрань</a>
        <a class="abbr">Нальчик</a>
        <a class="abbr">Находка</a>
        <a class="abbr">Невинномысск</a>
        <a class="abbr">Нефтекамск</a>
        <a class="abbr">Нефтеюганск</a>
        <a class="abbr">Нижневартовск</a>
        <a class="abbr">Нижнекамск</a>
        <a class="abbr">Нижний Новгород</a>
        <a class="abbr">Нижний Тагил</a>
        <a class="abbr">Новокузнецк</a>
        <a class="abbr">Новокуйбышевск</a>
        <a class="abbr">Новомосковск</a>
        <a class="abbr">Новороссийск</a>
        <a class="abbr">Новосибирск</a>
        <a class="abbr">Новочебоксарск</a>
        <a class="abbr">Новочеркасск</a>
        <a class="abbr">Новошахтинск</a>
        <a class="abbr">Новый Уренгой</a>
        <a class="abbr">Ногинск</a>
        <a class="abbr">Норильск</a>
        <a class="abbr">Ноябрьск</a>
        <a class="abbr">Обнинск</a>
        <a class="abbr">Одинцово</a>
        <a class="abbr">Октябрьский</a>
        <a class="abbr">Омск</a>
        <a class="abbr">Орёл</a>
        <a class="abbr">Оренбург</a>
        <a class="abbr">Орехово </a>
        <a class="abbr">Орск</a>
        <a class="abbr">Пенза</a>
        <a class="abbr">Первоуральск</a>
        <a class="abbr">Пермь</a>
        <a class="abbr">Петрозаводск</a>
        <a class="abbr">Петропавловск-Камчатский </a>
        <a class="abbr">Подольск</a>
        <a class="abbr">Прокопьевск</a>
        <a class="abbr">Псков</a>
        <a class="abbr">Пушкино</a>
        <a class="abbr">Пятигорск</a>
        <a class="abbr">Раменское</a>
        <a class="abbr">Ростов-на-Дону </a>
        <a class="abbr">Рубцовск</a>
        <a class="abbr">Рыбинск</a>
        <a class="abbr">Рязань</a>
        <a class="abbr">Салават</a>
        <a class="abbr">Самара</a>
        <a class="abbr">Санкт-Петербург </a>
        <a class="abbr">Саранск</a>
        <a class="abbr">Саратов</a>
        <a class="abbr">Севастополь </a>
        <a class="abbr">Северодвинск</a>
        <a class="abbr">Северск</a>
        <a class="abbr">Сергиев Посад</a>
        <a class="abbr">Серпухов</a>
        <a class="abbr">Симферополь </a>
        <a class="abbr">Смоленск</a>
        <a class="abbr">Сочи</a>
        <a class="abbr">Ставрополь</a>
        <a class="abbr">Старый Оскол</a>
        <a class="abbr">Стерлитамак</a>
        <a class="abbr">Сургут</a>
        <a class="abbr">Сызрань</a>
        <a class="abbr">Сыктывкар</a>
        <a class="abbr">Таганрог</a>
        <a class="abbr">Тамбов</a>
        <a class="abbr">Тверь</a>
        <a class="abbr">Тольятти</a>
        <a class="abbr">Томск</a>
        <a class="abbr">Тула</a>
        <a class="abbr">Тюмень</a>
        <a class="abbr">Улан-Удэ </a>
        <a class="abbr">Ульяновск</a>
        <a class="abbr">Уссурийск</a>
        <a class="abbr">Уфа</a>
        <a class="abbr">Хабаровск</a>
        <a class="abbr">Хасавюрт</a>
        <a class="abbr">Химки</a>
        <a class="abbr">Чебоксары</a>
        <a class="abbr">Челябинск</a>
        <a class="abbr">Череповец</a>
        <a class="abbr">Черкесск</a>
        <a class="abbr">Чита</a>
        <a class="abbr">Шахты</a>
        <a class="abbr">Щёлково</a>
        <a class="abbr">Электросталь</a>
        <a class="abbr">Элиста</a>
        <a class="abbr">Энгельс</a>
        <a class="abbr">Южно-Сахалинск </a>
        <a class="abbr">Якутск</a>
        <a class="abbr">Ярославль</a>
    </p>
</form>

<script>
$(document).ready(function() {

    var cit = [], k = [], r = [];
    {foreach from=ORM::factory('dpd_city')->order_by('name')->find_all()->as_array() key=k item=c}
    cit[{$k}] = "{$c->name|escape:html}";
    k[{$k}] = {$c->region_id};
    {/foreach}
    {foreach from=ORM::factory('dpd_region')->order_by('id')->find_all()->as_array() item=r}
    r[{$r->id}] = "{$r->name|escape:html}";
    {/foreach}

    $.getScript('/j/jquery.autocomplete.js', function () {
        $("#city-in-popup").autocomplete({
            lookup: cit,
            deferRequestBy: 3,
            minChars: 1,
            maxHeight: 300
        });
    });
});
</script>